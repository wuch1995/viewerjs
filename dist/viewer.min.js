/*!
 * Viewer.js v1.0.0
 * (c) 2019-2019 
 * Released under the MIT License.
 */
var e,t;e=this,t=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(t,i){if(t&&function(e){return"function"==typeof e}(i))if(Array.isArray(t)&&function(e){return"number"==typeof e&&!isNaN(e)}(t.length))for(var n=t.length,o=0;o<n&&!1!==i.call(t,t[o],o,t);o++);else(function(t){return"object"===e(t)&&null!==t})(t)&&Object.keys(t).forEach((function(e){i.call(t,t[e],e,t)}))}function a(e){var t=0,i=0,n=0;return o(e,(function(e){t+=e.pageX,i+=e.pageY,n++})),{pageX:t/=n,pageY:i/=n}}function h(e,t){return Math.sqrt(e*e+t*t)}function s(e){for(var t=[20,40,60,80,100],i=[.5,.4,.3,.2,.1],n=e,o=t.length;o--;)if(e>t[o]){n=(e-t[o])*i[o];for(var a=o;a>0;a--)n+=(t[a]-t[a-1])*i[a-1];n+=1*t[0];break}return n}function r(e,t){if(e.classList)e.classList.add(t);else{var i=e.className;i.indexOf(t)<0&&(e.className="".concat(i," ").concat(t))}}function l(e,t){if(e.classList)e.classList.remove(t);else{var i=e.className.trim();i.indexOf(t)>-1&&(i.replace(t,""),e.className="".concat(i))}}function m(e,t){Object.keys(t).forEach((function(i){e.style[i]=t[i]}))}function g(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.addEventListener(t,i,n)}var u="undefined"!=typeof window,c=u?window:{},d=(!!u&&c.document.documentElement,function(){function e(i,n,o){var a=this;t(this,e);var h=o.width,s=o.height;this.getImageNaturalSize(i,(function(e){a.naturalWidth=e.naturalWidth,a.naturalHeight=e.naturalHeight,a.ratio=e.naturalWidth/e.naturalHeight,a.src=e.src,a.width=h,a.height=s,a.index=n,a.transitioning=!1,a.el=null,e.naturalHeight*a.ratio>h?a.height=h/a.ratio:a.width=s*a.ratio,a.width=Math.min(a.width,h),a.height=Math.min(a.height,s),a.scale=a.width/e.naturalHeight,a.left=(h-a.width)/2,a.top=(s-a.height)/2,a.init={width:a.width,height:a.height,left:a.left,top:a.top},a.renderImage(o,n),a.initEvent()}))}return n(e,[{key:"initEvent",value:function(){var e=this;g(this.el,"transitionend",(function(){e.transitioning=!1,console.log("".concat(e.index,":").concat(e.transitioning))})),g(this.el,"transitionstart",(function(){e.transitioning=!0,console.log("".concat(e.index,":").concat(e.transitioning))}))}},{key:"getImageNaturalSize",value:function(e,t){if(e.complete)t(e);else{var i=document.createElement("img");i.src=e.src,i.onload=function(){t(i)}}}},{key:"renderImage",value:function(e,t){var i=document.createElement("div");r(i,"viewer-image-wrap"),m(i,{width:e.width+"px",height:e.height+"px",transform:"translate3d(".concat(t*e.width+30*t,"px, 0, 0)")});var n=document.createElement("img");n.src=this.src,i.appendChild(n),e.el.appendChild(i),this.el=n,this.reset()}},{key:"reset",value:function(){m(this.el,{width:this.width+"px",height:this.height+"px",marginLeft:this.left+"px",marginTop:this.top+"px"})}},{key:"resetInit",value:function(){this.width=this.init.width,this.height=this.init.height,this.left=this.init.left,this.top=this.init.top,r(this.el,"viewer-image-zoom"),m(this.el,{width:this.width+"px",height:this.height+"px",marginLeft:this.left+"px",marginTop:this.top+"px"})}},{key:"move",value:function(e,t){m(this.el,{marginLeft:e+"px",marginTop:t+"px"})}}]),e}()),f=function(){function e(){t(this,e),this.parent=document.body,this.el=null,this.closeEl=null,this.textEl=null,this.display=!1,this.init(),this.initEvent()}return n(e,[{key:"init",value:function(){var e=document.createElement("div");r(e,"viewer-container"),e.innerHTML='\n    <div class="viewer-header">\n      <span class="viewer-index"></span>\n      <span class="viewer-close">x</span>\n    </div>\n    <div class="viewer-wrap" touch-action="none"></div>\n  ',this.parent.appendChild(e),this.el=e,this.closeEl=e.querySelector(".viewer-close"),this.textEl=e.querySelector(".viewer-index")}},{key:"initEvent",value:function(){var e=this.el,t=this.closeEl;g(e,"transitionend",this.transitionEnd.bind(this)),g(t,"click",this.hide.bind(this))}},{key:"show",value:function(){var e=this,t=this.el,i=this.parent;r(t,"viewer-show"),r(i,"viewer-open"),setTimeout((function(){r(t,"viewer-fade-in"),e.display=!0}),20)}},{key:"hide",value:function(){l(this.el,"viewer-fade-in"),this.display=!1}},{key:"transitionEnd",value:function(){var e=this.el;this.display||l(e,"viewer-show")}},{key:"updateText",value:function(e){this.textEl.innerHTML=e}}]),e}(),p=function(){function e(i,n){t(this,e),this.images=[],this.zooming=!1,this.zoomMoving=!1,this.lastClickTime=0,this.mutipleZooming=!1,this.mutiZoom=!1,this.action="",this.viewer={el:null,height:window.innerHeight,width:window.innerWidth,contentWidth:0},this.touch={pageX:0,pageY:0,diff:0,currentLeft:0,currentIndex:0},this.imageZoom={diffX:0,diffY:0,pageX:0,pageY:0,pointer:{}},this.mutipleZoom={diffX:0,diffY:0,dist:0},this.touches=[],this.touchIds=new Set,this.container=new f,this.initViewer(),this.initImage(i)}return n(e,[{key:"initImage",value:function(e){var t=this;(e&&"img"===e.tagName.toLowerCase()?[e]:e.querySelectorAll("img")).forEach((function(e,i){t.images.push(new d(e,i,t.viewer))})),this.viewer.contentWidth=this.viewer.width*this.images.length+30*(this.images.length-1),this.image=this.images[this.touch.currentIndex],this.container.updateText("".concat(this.touch.currentIndex+1,"/").concat(this.images.length))}},{key:"initViewer",value:function(){var e=this.container.el;this.viewer.el=e.querySelector(".viewer-wrap"),g(this.viewer.el,"touchstart",this.onTouchStart.bind(this)),g(this.viewer.el,"touchmove",this.onTouchMove.bind(this)),g(this.viewer.el,"touchend",this.onTouchEnd.bind(this))}},{key:"show",value:function(){this.container.show()}},{key:"hide",value:function(){this.container.hide()}},{key:"onTouchStart",value:function(e){if(function(e,t,i,n){if(!(t.length>=2))for(var o=e.targetTouches,a=0;a<o.length;){if(2===t.length)return;var h=o[a].identifier,s=o[a];i.has(h)||s.target!==n||(t.push(s),i.add(h)),a++}}(e,this.touches,this.touchIds,this.image.el),1===this.touches.length){var t=[this.touches[0]];if(e.target===this.image.el){var i=Date.now();if(i-this.lastClickTime<300){if(this.zoomMoving)return;this.mutiZoom||this.zooming?(this.image.resetInit(),this.zooming=!1,this.mutiZoom=!1):(this.zoom(2,this.imageZoom.pointer=t),this.zooming=!0)}this.lastClickTime=i,e.preventDefault()}this.zooming?this.handleImageZoomStart(e):this.zooming||this.mutipleZooming||this.handleWrapPointerStart(e)}else this.handleMutipleZoomStart(e)}},{key:"onTouchMove",value:function(e){!function(e,t,i){var n=e.targetTouches;i.forEach((function(e){for(var i=0;i<n.length;)e===n[i].identifier&&t.splice(i,1,n[i]),i++}))}(e,this.touches,this.touchIds),1===this.touches.length?this.zooming?this.handleImageZoomMove(e):this.zooming||this.mutipleZooming||this.handleWrapPointerMove(e):this.handleMutipleZoomMove(e)}},{key:"onTouchEnd",value:function(e){if(1===this.touches.length){if(this.mutipleZooming)return;this.zooming?this.handleImageZoomEnd(e):this.zooming||this.handleWrapPointerEnd(e)}else this.handleMutipleZoomEnd(e);if(function(e,t,i){for(var n=e.changedTouches,o=0,a=function(){var e=n[o].identifier,a=t.findIndex((function(t){return t.identifier===e}));a>-1&&(t.splice(a,1),i.delete(e)),o++};o<n.length;)a()}(e,this.touches,this.touchIds),1===this.touches.length)for(var t=this.touches[0].identifier,i=e.touches,n=0;n<i.length;){if(t===i[n].identifier)return this.touch.pageX=i[n].pageX,this.touch.pageY=i[n].pageY,this.imageZoom.pageX=i[n].pageX,this.imageZoom.pageY=i[n].pageY,this.imageZoom.timerready=!0,this.imageZoom.startX=i[n].pageX,void(this.imageZoom.startY=i[n].pageY);n++}}},{key:"handleMutipleZoomStart",value:function(e){l(this.image.el,"viewer-image-zoom"),this.mutipleZooming=!0,this.mutiZoom=!0,this.zooming=!0;var t=this.touches,i=t[0],n=t[1],o=Math.abs(i.pageX-n.pageX),a=Math.abs(i.pageY-n.pageY);this.mutipleZoom.dist=h(o,a),this.mutipleZoom.diff=this.mutipleZoom.dist-0}},{key:"handleMutipleZoomMove",value:function(e){console.log("handleMutipleZoomMove"),l(this.image.el,"viewer-image-zoom");var t=e.touches,i=t[0],n=t[1],o=h(Math.abs(i.pageX-n.pageX),Math.abs(i.pageY-n.pageY))-this.mutipleZoom.diff,s=this.image,r=s.width,g=s.height,u=s.left,c=s.top,d=o+r,f=o+g,p=a(t),v=u-o*(p.pageX-u)/r,w=c-o*(p.pageY-c)/g;this.mutipleZoom.width=d,this.mutipleZoom.height=f,this.mutipleZoom.left=v,this.mutipleZoom.top=w,m(this.image.el,{width:d+"px",height:f+"px",marginLeft:v+"px",marginTop:w+"px"})}},{key:"handleMutipleZoomEnd",value:function(e){console.log("handleMutipleZoomEnd"),r(this.image.el,"viewer-image-zoom"),this.mutipleZooming=!1;var t=this.image.init;this.mutipleZoom.width<t.width||this.mutipleZoom.height<t.height?(this.zooming=!1,this.mutiZoom=!1,this.image.width=t.width,this.image.height=t.height,this.image.left=t.left,this.image.top=t.top,this.image.reset()):(this.image.width=this.mutipleZoom.width,this.image.height=this.mutipleZoom.height,this.image.left=this.mutipleZoom.left,this.image.top=this.mutipleZoom.top)}},{key:"zoom",value:function(e,t){r(this.image.el,"viewer-image-zoom");var i=this.image,n=i.naturalWidth,o=i.naturalHeight,h=i.width,s=i.height,l=i.left,m=i.top,g=n*e,u=o*e,c=g-h,d=u-s;if(this.image.scale=Number((g/n).toFixed(2)),t){var f=a(t);this.image.left-=c*(f.pageX-l)/h,this.image.top-=d*(f.pageY-m)/s}else this.image.left-=c/2,this.image.top-=d/2;this.image.width=g,this.image.height=u,this.image.reset()}},{key:"handleWrapPointerStart",value:function(e){console.log("handleWrapPointerStart");var t=this.touches;t&&1===t.length&&(this.touch.pageX=t[0].pageX,this.touch.pageY=t[0].pageY)}},{key:"handleWrapPointerMove",value:function(e){console.log("handleWrapPointerMove"),console.log(this.touches);var t=e.touches,i=this.touch.currentLeft,n=this.viewer,o=n.contentWidth,a=n.width,h=t[0].pageX-this.touch.pageX,r=i+h,l=Math.abs(r);r>0?r=s(r):l>o-a&&(r=-(o-a+s(l-o+a))),m(this.viewer.el,{transform:"translate3d(".concat(r,"px, 0, 0)"),transitionDuration:"0ms"}),this.touch.diff=h}},{key:"handleWrapPointerEnd",value:function(e){console.log("handleWrapPointerEnd");var t=this.touch,i=this.viewer,n=i.el,o=i.width,a=t.diff+t.currentLeft;Math.abs(t.diff)>100?t.diff>0?0===t.currentIndex?a=t.currentLeft:(t.currentIndex--,a=t.currentLeft+o+30):t.currentIndex===this.images.length-1?a=t.currentLeft:(t.currentIndex++,a=t.currentLeft-o-30):a=t.currentLeft,m(n,{webkitTransform:"translate3d(".concat(a,"px, 0, 0)"),webkitTransitionDuration:"300ms"}),this.image=this.images[t.currentIndex],t.currentLeft=a,t.diff=0,this.container.updateText("".concat(t.currentIndex+1,"/").concat(this.images.length))}},{key:"handleImageZoomStart",value:function(e){console.log("handleImageZoomStart");var t=this.touches;t&&1===t.length&&(this.imageZoom.pageX=t[0].pageX,this.imageZoom.pageY=t[0].pageY,this.imageZoom.timerready=!0,this.imageZoom.startX=t[0].pageX,this.imageZoom.startY=t[0].pageY)}},{key:"handleImageZoomMove",value:function(e){console.log("handleImageZoomMove"),l(this.image.el,"viewer-image-zoom"),this.zoomMoving=!0,this.imageZoom.timerready&&(this.imageZoom.startTime=+new Date,this.imageZoom.timerready=!1);var t=e.touches,i=this.imageZoom,n=i.pageX,o=i.pageY,a=this.image,h=a.left,s=a.top,r=t[0].pageX-n,g=t[0].pageY-o,u=h+r,c=s+g;m(this.image.el,{marginLeft:u+"px",marginTop:c+"px"}),this.imageZoom.diffX=r,this.imageZoom.diffY=g,this.image.left=u,this.image.top=c,this.imageZoom.pageX=t[0].pageX,this.imageZoom.pageY=t[0].pageY}},{key:"handleImageZoomEnd",value:function(e){if(console.log("handleImageZoomEnd"),this.zoomMoving){var t=this.viewer,i=(t.width,t.height,this.image);i.width,i.height,i.left,i.top,this.imageZoom.endTime=+new Date;var n=this.imageZoom,o=n.pageX,a=n.pageY,s=n.startX,l=n.startY,m=n.startTime,g=n.endTime,u=s-o,c=l-a,d=h(u,c);if(0!==d){var f=d/(g-m)*16.67,p=Math.min(10,f),v=this,w=!1;!function e(){var t=(f-=f/p)*u/d,i=f*c/d;v.image.left-=t,v.image.top-=i,w&&(r(v.image.el,"viewer-image-zoom"),f=0,w=!1),v.image.move(v.image.left,v.image.top),f<.1?(f=0,v.zoomMoving=!1):requestAnimationFrame(e)}()}}}},{key:"view",value:function(e){}}]),e}();return function(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".viewer-container {\n  position: fixed;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0);\n  z-index: 999;\n  display: none;\n  opacity: 0;\n  transition: opacity .5s;\n  user-select: none;\n}\n\n.viewer-wrap {\n  height: 100%;\n  font-size: 0;\n  background: rgba(0, 0, 0, .9);\n}\n\n.viewer-open {\n  overflow: hidden;\n  position: fixed;\n}\n\n.viewer-show {\n  display: block;\n}\n\n.viewer-fade-in {\n  opacity: 1;\n}\n\n.viewer-image-wrap {\n  position: absolute;\n  background: rgba(0, 0, 0, .9);\n}\n\n.viewer-header {\n  position: absolute;\n  top: 0;\n  z-index: 1;\n  left: 0;\n  right: 0;\n  color: #fff;\n  display: flex;\n  align-items: center;\n  padding: 0 10px;\n  height: 25px;\n}\n\n/* .viewer-header > span {\n  display: inline-block;\n  height: 20px;\n} */\n\n.viewer-image-zoom {\n  transition: all .3s;\n}\n\n.viewer-close {\n  font-size: 20px;\n  margin-left: auto;\n}"),p},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Viewer=t();