/*!
 * Viewer.js v1.0.0
 * (c) 2019-2019 
 * Released under the MIT License.
 */
function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(e,i){if(e&&function(t){return"function"==typeof t}(i))if(Array.isArray(e)&&function(t){return"number"==typeof t&&!isNaN(t)}(e.length))for(var n=e.length,o=0;o<n&&!1!==i.call(e,e[o],o,e);o++);else(function(e){return"object"===t(e)&&null!==e})(e)&&Object.keys(e).forEach((function(t){i.call(e,e[t],t,e)}))}function a(t){var e=0,i=0,n=0;return o(t,(function(t){e+=t.pageX,i+=t.pageY,n++})),{pageX:e/=n,pageY:i/=n}}function h(t,e){return Math.sqrt(t*t+e*e)}function s(t){for(var e=[20,40,60,80,100],i=[.5,.4,.3,.2,.1],n=t,o=e.length;o--;)if(t>e[o]){n=(t-e[o])*i[o];for(var a=o;a>0;a--)n+=(e[a]-e[a-1])*i[a-1];n+=1*e[0];break}return n}function r(t,e){if(t.classList)t.classList.add(e);else{var i=t.className;i.indexOf(e)<0&&(t.className="".concat(i," ").concat(e))}}function l(t,e){if(t.classList)t.classList.remove(e);else{var i=t.className.trim();i.indexOf(e)>-1&&(i.replace(e,""),t.className="".concat(i))}}function m(t,e){Object.keys(e).forEach((function(i){t.style[i]=e[i]}))}function g(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.addEventListener(e,i,n)}var u="undefined"!=typeof window,c=u?window:{},d=(!!u&&c.document.documentElement,function(){function t(i,n,o){var a=this;e(this,t);var h=o.width,s=o.height;this.getImageNaturalSize(i,(function(t){a.naturalWidth=t.naturalWidth,a.naturalHeight=t.naturalHeight,a.ratio=t.naturalWidth/t.naturalHeight,a.src=t.src,a.width=h,a.height=s,a.index=n,a.transitioning=!1,a.el=null,t.naturalHeight*a.ratio>h?a.height=h/a.ratio:a.width=s*a.ratio,a.width=Math.min(a.width,h),a.height=Math.min(a.height,s),a.scale=a.width/t.naturalHeight,a.left=(h-a.width)/2,a.top=(s-a.height)/2,a.init={width:a.width,height:a.height,left:a.left,top:a.top},a.renderImage(o,n),a.initEvent()}))}return n(t,[{key:"initEvent",value:function(){var t=this;g(this.el,"transitionend",(function(){t.transitioning=!1,console.log("".concat(t.index,":").concat(t.transitioning))})),g(this.el,"transitionstart",(function(){t.transitioning=!0,console.log("".concat(t.index,":").concat(t.transitioning))}))}},{key:"getImageNaturalSize",value:function(t,e){if(t.complete)e(t);else{var i=document.createElement("img");i.src=t.src,i.onload=function(){e(i)}}}},{key:"renderImage",value:function(t,e){var i=document.createElement("div");r(i,"viewer-image-wrap"),m(i,{width:t.width+"px",height:t.height+"px",transform:"translate3d(".concat(e*t.width+30*e,"px, 0, 0)")});var n=document.createElement("img");n.src=this.src,i.appendChild(n),t.el.appendChild(i),this.el=n,this.reset()}},{key:"reset",value:function(){m(this.el,{width:this.width+"px",height:this.height+"px",marginLeft:this.left+"px",marginTop:this.top+"px"})}},{key:"resetInit",value:function(){this.width=this.init.width,this.height=this.init.height,this.left=this.init.left,this.top=this.init.top,r(this.el,"viewer-image-zoom"),m(this.el,{width:this.width+"px",height:this.height+"px",marginLeft:this.left+"px",marginTop:this.top+"px"})}},{key:"move",value:function(t,e){m(this.el,{marginLeft:t+"px",marginTop:e+"px"})}}]),t}()),f=function(){function t(){e(this,t),this.parent=document.body,this.el=null,this.closeEl=null,this.textEl=null,this.display=!1,this.init(),this.initEvent()}return n(t,[{key:"init",value:function(){var t=document.createElement("div");r(t,"viewer-container"),t.innerHTML='\n    <div class="viewer-header">\n      <span class="viewer-index"></span>\n      <span class="viewer-close">x</span>\n    </div>\n    <div class="viewer-wrap" touch-action="none"></div>\n  ',this.parent.appendChild(t),this.el=t,this.closeEl=t.querySelector(".viewer-close"),this.textEl=t.querySelector(".viewer-index")}},{key:"initEvent",value:function(){var t=this.el,e=this.closeEl;g(t,"transitionend",this.transitionEnd.bind(this)),g(e,"click",this.hide.bind(this))}},{key:"show",value:function(){var t=this,e=this.el,i=this.parent;r(e,"viewer-show"),r(i,"viewer-open"),setTimeout((function(){r(e,"viewer-fade-in"),t.display=!0}),20)}},{key:"hide",value:function(){l(this.el,"viewer-fade-in"),this.display=!1}},{key:"transitionEnd",value:function(){var t=this.el;this.display||l(t,"viewer-show")}},{key:"updateText",value:function(t){this.textEl.innerHTML=t}}]),t}(),p=function(){function t(i,n){e(this,t),this.images=[],this.zooming=!1,this.zoomMoving=!1,this.lastClickTime=0,this.mutipleZooming=!1,this.mutiZoom=!1,this.action="",this.viewer={el:null,height:window.innerHeight,width:window.innerWidth,contentWidth:0},this.touch={pageX:0,pageY:0,diff:0,currentLeft:0,currentIndex:0},this.imageZoom={diffX:0,diffY:0,pageX:0,pageY:0,pointer:{}},this.mutipleZoom={diffX:0,diffY:0,dist:0},this.touches=[],this.touchIds=new Set,this.container=new f,this.initViewer(),this.initImage(i)}return n(t,[{key:"initImage",value:function(t){var e=this;(t&&"img"===t.tagName.toLowerCase()?[t]:t.querySelectorAll("img")).forEach((function(t,i){e.images.push(new d(t,i,e.viewer))})),this.viewer.contentWidth=this.viewer.width*this.images.length+30*(this.images.length-1),this.image=this.images[this.touch.currentIndex],this.container.updateText("".concat(this.touch.currentIndex+1,"/").concat(this.images.length))}},{key:"initViewer",value:function(){var t=this.container.el;this.viewer.el=t.querySelector(".viewer-wrap"),g(this.viewer.el,"touchstart",this.onTouchStart.bind(this)),g(this.viewer.el,"touchmove",this.onTouchMove.bind(this)),g(this.viewer.el,"touchend",this.onTouchEnd.bind(this))}},{key:"show",value:function(){this.container.show()}},{key:"hide",value:function(){this.container.hide()}},{key:"onTouchStart",value:function(t){if(function(t,e,i,n){if(!(e.length>=2))for(var o=t.targetTouches,a=0;a<o.length;){if(2===e.length)return;var h=o[a].identifier,s=o[a];i.has(h)||s.target!==n||(e.push(s),i.add(h)),a++}}(t,this.touches,this.touchIds,this.image.el),1===this.touches.length){var e=[this.touches[0]];if(t.target===this.image.el){var i=Date.now();if(i-this.lastClickTime<300){if(this.zoomMoving)return;this.mutiZoom||this.zooming?(this.image.resetInit(),this.zooming=!1,this.mutiZoom=!1):(this.zoom(2,this.imageZoom.pointer=e),this.zooming=!0)}this.lastClickTime=i,t.preventDefault()}this.zooming?this.handleImageZoomStart(t):this.zooming||this.mutipleZooming||this.handleWrapPointerStart(t)}else this.handleMutipleZoomStart(t)}},{key:"onTouchMove",value:function(t){!function(t,e,i){var n=t.targetTouches;i.forEach((function(t){for(var i=0;i<n.length;)t===n[i].identifier&&e.splice(i,1,n[i]),i++}))}(t,this.touches,this.touchIds),1===this.touches.length?this.zooming?this.handleImageZoomMove(t):this.zooming||this.mutipleZooming||this.handleWrapPointerMove(t):this.handleMutipleZoomMove(t)}},{key:"onTouchEnd",value:function(t){if(1===this.touches.length){if(this.mutipleZooming)return;this.zooming?this.handleImageZoomEnd(t):this.zooming||this.handleWrapPointerEnd(t)}else this.handleMutipleZoomEnd(t);if(function(t,e,i){for(var n=t.changedTouches,o=0,a=function(){var t=n[o].identifier,a=e.findIndex((function(e){return e.identifier===t}));a>-1&&(e.splice(a,1),i.delete(t)),o++};o<n.length;)a()}(t,this.touches,this.touchIds),1===this.touches.length)for(var e=this.touches[0].identifier,i=t.touches,n=0;n<i.length;){if(e===i[n].identifier)return this.touch.pageX=i[n].pageX,this.touch.pageY=i[n].pageY,this.imageZoom.pageX=i[n].pageX,this.imageZoom.pageY=i[n].pageY,this.imageZoom.timerready=!0,this.imageZoom.startX=i[n].pageX,void(this.imageZoom.startY=i[n].pageY);n++}}},{key:"handleMutipleZoomStart",value:function(t){l(this.image.el,"viewer-image-zoom"),this.mutipleZooming=!0,this.mutiZoom=!0,this.zooming=!0;var e=this.touches,i=e[0],n=e[1],o=Math.abs(i.pageX-n.pageX),a=Math.abs(i.pageY-n.pageY);this.mutipleZoom.dist=h(o,a),this.mutipleZoom.diff=this.mutipleZoom.dist-0}},{key:"handleMutipleZoomMove",value:function(t){console.log("handleMutipleZoomMove"),l(this.image.el,"viewer-image-zoom");var e=t.touches,i=e[0],n=e[1],o=h(Math.abs(i.pageX-n.pageX),Math.abs(i.pageY-n.pageY))-this.mutipleZoom.diff,s=this.image,r=s.width,g=s.height,u=s.left,c=s.top,d=o+r,f=o+g,p=a(e),v=u-o*(p.pageX-u)/r,w=c-o*(p.pageY-c)/g;this.mutipleZoom.width=d,this.mutipleZoom.height=f,this.mutipleZoom.left=v,this.mutipleZoom.top=w,m(this.image.el,{width:d+"px",height:f+"px",marginLeft:v+"px",marginTop:w+"px"})}},{key:"handleMutipleZoomEnd",value:function(t){console.log("handleMutipleZoomEnd"),r(this.image.el,"viewer-image-zoom"),this.mutipleZooming=!1;var e=this.image.init;this.mutipleZoom.width<e.width||this.mutipleZoom.height<e.height?(this.zooming=!1,this.mutiZoom=!1,this.image.width=e.width,this.image.height=e.height,this.image.left=e.left,this.image.top=e.top,this.image.reset()):(this.image.width=this.mutipleZoom.width,this.image.height=this.mutipleZoom.height,this.image.left=this.mutipleZoom.left,this.image.top=this.mutipleZoom.top)}},{key:"zoom",value:function(t,e){r(this.image.el,"viewer-image-zoom");var i=this.image,n=i.naturalWidth,o=i.naturalHeight,h=i.width,s=i.height,l=i.left,m=i.top,g=n*t,u=o*t,c=g-h,d=u-s;if(this.image.scale=Number((g/n).toFixed(2)),e){var f=a(e);this.image.left-=c*(f.pageX-l)/h,this.image.top-=d*(f.pageY-m)/s}else this.image.left-=c/2,this.image.top-=d/2;this.image.width=g,this.image.height=u,this.image.reset()}},{key:"handleWrapPointerStart",value:function(t){console.log("handleWrapPointerStart");var e=this.touches;e&&1===e.length&&(this.touch.pageX=e[0].pageX,this.touch.pageY=e[0].pageY)}},{key:"handleWrapPointerMove",value:function(t){console.log("handleWrapPointerMove"),console.log(this.touches);var e=t.touches,i=this.touch.currentLeft,n=this.viewer,o=n.contentWidth,a=n.width,h=e[0].pageX-this.touch.pageX,r=i+h,l=Math.abs(r);if(r>0)r=s(r);else if(l>o-a){r=-(o-a+s(l-o+a))}m(this.viewer.el,{transform:"translate3d(".concat(r,"px, 0, 0)"),transitionDuration:"0ms"}),this.touch.diff=h}},{key:"handleWrapPointerEnd",value:function(t){console.log("handleWrapPointerEnd");var e=this.touch,i=this.viewer,n=i.el,o=i.width,a=e.diff+e.currentLeft;Math.abs(e.diff)>100?e.diff>0?0===e.currentIndex?a=e.currentLeft:(e.currentIndex--,a=e.currentLeft+o+30):e.currentIndex===this.images.length-1?a=e.currentLeft:(e.currentIndex++,a=e.currentLeft-o-30):a=e.currentLeft,m(n,{webkitTransform:"translate3d(".concat(a,"px, 0, 0)"),webkitTransitionDuration:"300ms"}),this.image=this.images[e.currentIndex],e.currentLeft=a,e.diff=0,this.container.updateText("".concat(e.currentIndex+1,"/").concat(this.images.length))}},{key:"handleImageZoomStart",value:function(t){console.log("handleImageZoomStart");var e=this.touches;e&&1===e.length&&(this.imageZoom.pageX=e[0].pageX,this.imageZoom.pageY=e[0].pageY,this.imageZoom.timerready=!0,this.imageZoom.startX=e[0].pageX,this.imageZoom.startY=e[0].pageY)}},{key:"handleImageZoomMove",value:function(t){console.log("handleImageZoomMove"),l(this.image.el,"viewer-image-zoom"),this.zoomMoving=!0,this.imageZoom.timerready&&(this.imageZoom.startTime=+new Date,this.imageZoom.timerready=!1);var e=t.touches,i=this.imageZoom,n=i.pageX,o=i.pageY,a=this.image,h=a.left,s=a.top,r=e[0].pageX-n,g=e[0].pageY-o,u=h+r,c=s+g;m(this.image.el,{marginLeft:u+"px",marginTop:c+"px"}),this.imageZoom.diffX=r,this.imageZoom.diffY=g,this.image.left=u,this.image.top=c,this.imageZoom.pageX=e[0].pageX,this.imageZoom.pageY=e[0].pageY}},{key:"handleImageZoomEnd",value:function(t){if(console.log("handleImageZoomEnd"),this.zoomMoving){var e=this.viewer,i=(e.width,e.height,this.image);i.width,i.height,i.left,i.top;this.imageZoom.endTime=+new Date;var n=this.imageZoom,o=n.pageX,a=n.pageY,s=n.startX,l=n.startY,m=n.startTime,g=n.endTime,u=s-o,c=l-a,d=h(u,c);if(0!==d){var f=d/(g-m)*16.67,p=Math.min(10,f),v=this,w=!1;!function t(){var e=(f-=f/p)*u/d,i=f*c/d;v.image.left-=e,v.image.top-=i,w&&(r(v.image.el,"viewer-image-zoom"),f=0,w=!1),v.image.move(v.image.left,v.image.top),f<.1?(f=0,v.zoomMoving=!1):requestAnimationFrame(t)}()}}}},{key:"view",value:function(t){}}]),t}();!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}(".viewer-container {\n  position: fixed;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0);\n  z-index: 999;\n  display: none;\n  opacity: 0;\n  transition: opacity .5s;\n  user-select: none;\n}\n\n.viewer-wrap {\n  height: 100%;\n  font-size: 0;\n  background: rgba(0, 0, 0, .9);\n}\n\n.viewer-open {\n  overflow: hidden;\n  position: fixed;\n}\n\n.viewer-show {\n  display: block;\n}\n\n.viewer-fade-in {\n  opacity: 1;\n}\n\n.viewer-image-wrap {\n  position: absolute;\n  background: rgba(0, 0, 0, .9);\n}\n\n.viewer-header {\n  position: absolute;\n  top: 0;\n  z-index: 1;\n  left: 0;\n  right: 0;\n  color: #fff;\n  display: flex;\n  align-items: center;\n  padding: 0 10px;\n  height: 25px;\n}\n\n/* .viewer-header > span {\n  display: inline-block;\n  height: 20px;\n} */\n\n.viewer-image-zoom {\n  transition: all .3s;\n}\n\n.viewer-close {\n  font-size: 20px;\n  margin-left: auto;\n}");export default p;